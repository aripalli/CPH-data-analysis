<!doctype html>
<html>
<head>
<meta charset="UTF8">
<title>Social Data & Visualization - Final Project</title>
<link rel="stylesheet" href="styles/styles.css?version=1" type="text/css" />
<link rel="stylesheet" href="styles/svg-styles.css?version=25" type="text/css" />
<link rel="stylesheet" href="//code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
<script src="https://code.jquery.com/jquery-1.12.4.js"></script>
<script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
<script type="text/javascript" src="d3/d3.js"></script>
<script type="text/javascript" src="d3/index.js"></script>
<script src="d3/colorbrewer.min.js"></script>
<!--[if lt IE 9]>
<script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script>
<![endif]-->
<!--
anatine, a free CSS web template by ZyPOP (zypopwebtemplates.com/)

Download: http://zypopwebtemplates.com/

License: Creative Commons Attribution
//-->
<meta name="viewport" content="width=device-width, minimum-scale=1.0, maximum-scale=1.0" />
</head>

<body>
<section id="body" class="width">
<aside id="sidebar" class="column-left">
	<header>
		<h1><a href="#">Final<br> Project</a></h1>
		<h2>Social Data & Visualization<br>Course 02806 @ DTU </h2>
	</header>
	<nav id="mainnav">
		<ul>
	            	<li><a href="index.html">Home</a></li>
	           		<li><a href="aboutdata.html">About the data</a></li>
                <li><a href="nationality.html">Nationality distribution</a></li>
	           		<li><a href="pred.html">Interactive map</a></li>
	           		<li><a href="machinelearning.html">Machine Learning</a></li>
	            	<li><a href="ipython.html">Ipython notebook</a></li>
		</ul>
	</nav>
</aside>
		
<section id="content" class="column-right">  		
	<article>			<div class="inside-article">				
	<h2>Machine Learning</h2>

		<div class="text-container">
			<p>
				In this section the Socio data set will be explored using different machine learning techniques.
				The goal is to use this data to both get insight into what features are important when predicting different values, and to see how well we can predict.
				We want to predict the following:
			</p>
		</div>
		<ol>
		<li>Predict how many have a high income</li>
		<li>Predict how many are above 65 years old</li>
		<li>Predict how many danes live in a given rode.</li>
		</ol>
		<p>
		The predicts will be made both with an elastic net method and a random forest regression method. The elastic net is a linear method while the random forest is not. Both methods will be used and compared.
		For both methods the <i>root mean square error (RMSE)</i> will be given as an estimate of the error.</p>
		<div style="  width: 50%;
  margin: 0 auto;"><img src="figures/RMSE.JPG" alt="RMSE" style="width:300px;height:100%;"></div>

		<p>
		Furthermore the features that the methods deem most important will be investigated.
		This will serve as a guideline if you for instance want to find a district with a lot of wealthy people, then you woold know what other features to look for.
		</p>
		<p>
		By looking carefully at the results below, you will be off to the district of your dreams in no time!
		</p>


	</div>
	</article>
	
	<article><div class="inside-article">				
	<h2>Random Forest</h2>
		<div class="article-info">Regression</div>

			<p>
			Using a random forest regression method the 3 responses mentioned above were predicted. Doing a 10 fold cross-validation to get an estimate of the error gave the results in the table below.
			The errors are represented as the <i>root mean square error (RMSE) </i>:
			</p>
		
		<p>
		The method was used both using data only for a given year but also when all the data from all years is used. The error of the predictions is presented together with a 95% prediction interval
		</p>
	<table style="width:100%" class="table1">
	  <tr>
	  <col width="100">
		<th>Year</th>
		<th>High income <br>prediction - RMSE</th>
		<th>Percent danes <br>in a rode prediction - RMSE</th>
		<th>Above 65 years <br>prediction - RMSE</th>

	  </tr>
	  <tr>
		<td>All years</td>
		<td>2.74% &plusmn 1.29%</td> 
		<td>3.40% &plusmn 3.68%</td> 
		<td>2.33% &plusmn 2.70%</td> 
	  </tr>
	  <tr>
		<td>2008</td>
		<td>5.31% &plusmn 2.59% </td> 
		<td>6.10% &plusmn 5.66%</td> 
		<td>5.97% &plusmn 5.00%</td> 
	  </tr>
	  <tr>
		<td>2009</td>
		<td>4.89% &plusmn 3.57%</td> 
		<td>5.61% &plusmn 3.60%</td> 
		<td>5.14% &plusmn 2.98%</td> 
	  </tr>
	  	  <tr>
		<td>2010</td>
		<td>4.29% &plusmn 1.22%</td> 
		<td>5.58% &plusmn 4.70%</td> 
		<td>5.02% &plusmn 3.47%</td> 
	  </tr>
	  <tr>
		<td>2011</td>
		<td>4.26% &plusmn 1.86%</td> 
		<td>5.82% &plusmn 2.59%</td> 
		<td>4.99% &plusmn 3.98%</td> 
	  </tr>
	  <tr>
		<td>2012</td>
		<td>4.10% &plusmn 1.86%</td> 
		<td>5.72% &plusmn 2.29%</td> 
		<td>5.12% &plusmn 3.27%</td> 
	  </tr>
	  <tr>
		<td>2013</td>
		<td>4.01% &plusmn 1.51%</td> 
		<td>5.99% &plusmn 2.98%</td> 
		<td>4.65% &plusmn 3.49%</td> 
	  </tr>
	</table>
		<p>
		</p>
			<p>
			The table suggests that we can actually predict the output quite well with most errors being around 5%. It should also be noted how the error is around half of the others, when all the data is used.
			This makes sense as random forest methods often perform better the more data they have available. The conclusion is that by looking at other features in the data, we can tell a lot about the 3
			features we want to predict.
			
			</p>
			<p>
			All of that might sound good, but what is in it for you? Below are the top 10 features that random forest deem most important when predicting.
			By looking at these you can find things that you should look for if you want to find a district with the predicted feature.
			It should be noted that an important feature can both be something you should look for or something you should avoid. For instance is the 9th most important feature for predicting
			high income that people have no education. Logically this is probably because districts where this number is high have a low "high income" number.
			The features are the ones found when all the data is used.
			</p>
	<table style="width:100%">
	  <tr>
		<th>Predicting amount of people with high income</th>
		<th>Predicting amount of danes</th>
		<th>Predicting amount of people above 65 years </th>
	  </tr>
	  <tr>
		<td><small>1. Percent houses larger than m<sup>2</sup></small> </td>
		<td><small>1. Percent without an education </td>
		<td><small>1. Percent with a medium income</small> </td>

	  </tr>
	  <tr>
		<td><small>2. Percent with a long education </small></td>
		<td><small>2. Percent singles without children </small></td>
		<td><small>2. Percent singles without children</small></td>

	  </tr>
	  <tr>
		<td><small>3. Percent owner-occupied dwelling</td>
		<td><small>3. Percent people between 18-29 years </small></td>
		<td><small>3. Average home area pr. person</small></td>

	  </tr>
	  <tr>
		<td><small>4. Percent with a medium long education</td>
		<td><small>4. Percent people between 30-39 years</small></td>
		<td><small>4. Percent homes build 1930-1949</small></td>
	
	  </tr>
	  <tr>
		<td><small>5. Percent wage earners</td>
		<td><small>5. Percent people between 40-49 years </small></td>
		<td><small>5. Percent other home types</small></td>

	  </tr>
	  <tr>
		<td><small>6. Percent couples with children </td>
		<td><small>6. Percent people between 50-64 years  </small></td>
		<td><small>6. Percent homes build 1950-1979</small></td>

	  </tr>
	  <tr>
		<td><small>7. Percent people with their own business </td>
		<td><small>7. Percent with a job</small></td>
		<td><small>7. Percent houses with size 60m<sup>2</sup>-79m<sup>2</sup></small></td>

	  </tr>
	  	  <tr>
		<td><small>8. Percent net newcomers</td>
		<td><small>8. Percent people studying</small></td>
		<td><small>8. Percent people with a workman education</small></td>

	  </tr>
	  <tr>
		<td><small>9. Percent people with no education</td>
		<td><small>9. Average house area pr. person</small></td>
		<td><small>9. Percent homes build 1900-1929</small></td>

	  </tr>
	  <tr>
		<td><small>10. Average home area pr. person</td>
		<td><small>10. Percent general housing</small></td>
		<td><small>10. Percent general housing</small></td>

	  </tr>
	</table>
	<p>
	</p>
			<p>
			A lot of the features in top 10 probably make good sense. However some might be surprising. It  for instance seem really important to look at the age distribution if you want to find out
			how many danes there are in a district. This suggests that foreigners in Denmark are found in specific age groups. Number 2 feature here is singles without children. This also makes good sense
			since refugees fleeing from a war often bring all of their family.
			</p>
			</div>
	</article>

<article><div class="inside-article">				
	<h2>Elastic net</h2>
		<div class="article-info">Regression</div>
			<p>
			The same analysis is done with an elastic net. The errors here are also presented together with a 95% prediction interval.
			</p>
	<table style="width:100%" class="table1">
	
	  <tr>
	  <col width="100">
		<th>Year</th>
		<th>High income <br>prediction - RMSE</th>
		<th>Percent danes in <br>a rode prediction - RMSE</th>
		<th>Above 65 years <br>prediction - RMSE</th>

	  </tr>
	  <tr>
		<td>All years</td>
		<td>5.84% &plusmn 1.06%</td> 
		<td>4.79% &plusmn 2.02%</td> 
		<td>3.99% &plusmn 1.94%</td> 
	  </tr>
	  <tr>
		<td>2008</td>
		<td>5.58% &plusmn 3.72%</td>
		<td>7.96% &plusmn 8.41%</td> 
		<td>6.41% &plusmn 6.53%</td> 
	  </tr>
	  <tr>
		<td>2009</td>
		<td>3.68% &plusmn 3.92%</td>
		<td>4.96% &plusmn 2.51%</td> 
		<td>3.91% &plusmn 2.51%</td> 		
	  </tr>
	  	  <tr>
		<td>2010</td>
		<td>2.76% &plusmn 0.98%</td> 
		<td>4.82% &plusmn 2.80%</td> 
		<td>3.79% &plusmn 2.61%</td> 
	  </tr>
	  <tr>
		<td>2011</td>
		<td>2.86% &plusmn 1.20%</td>
		<td>4.67% &plusmn 1.39%</td> 
		<td>4.04% &plusmn 2.72%</td> 
	  </tr>
	  <tr>
		<td>2012</td>
		<td>2.67% &plusmn 0.73%</td> 
		<td>4.52% &plusmn 1.55%</td> 
		<td>3.90% &plusmn 2.69%</td> 
	  </tr>
	  <tr>
		<td>2013</td>
		<td>2.69% &plusmn 0.84%</td> 
		<td>4.57% &plusmn 1.35%</td> 
		<td>3.87% &plusmn 2.45%</td> 
	  </tr>
	</table>
		<p>
		</p>
		
			<p>
			Here the errors actually increase when the data from all years are used. And it is actually quite low when looking at individual years. Except for 2008.
			Normally random forest outperforms elastic net. However when there is a lot of features compared to the data, which is the case when only one year is analysed, then elastic net shines
			since the method is really good at doing dimensionality reduction.
			</p>
			<p>
			The top 10 features that elastic net deem most important are presented below. They are not identical to the ones that random forest found, but they tend to agree with most. Again a lot of the 
			most important features make sense when you think about what you expectations might be.
			</p>
	<table style="width:100%">
	  <tr>
		<th>Predicting amount of people with high income</th>
		<th>Predicting amount of danes</th>
		<th>Predicting amount of people above 65 years </th>
	  </tr>
	  <tr>
		<td><small>1. Percent people with a job</small> </td>
		<td><small>1. Percent singles without children</small> </td>
		<td><small>1. Percent with a medium income</small> </td>

	  </tr>
	  <tr>
		<td><small>2. Percent owner-occupied dwelling </small></td>
		<td><small>2. Percent above 65 years</small></td>
		<td><small>2. Percent singles without children</small></td>

	  </tr>
	  <tr>
		<td><small>3. Perecentage with a long education</td>
		<td><small>3. Percent people with a workman education</small></td>
		<td><small>3. Average home area pr. person</small></td>

	  </tr>
	  <tr>
		<td><small>4. Average home area pr. person </td>
		<td><small>4. Percent between 18-29 years</small></td>
		<td><small>4. Percent danes</small></td>
	
	  </tr>
	  <tr>
		<td><small>5. Percent with a medium long education</td>
		<td><small>5. Percent between 40-49 years</small></td>
		<td><small>5. Percent houses larger than m<sup>2</sup></small></td>

	  </tr>
	  <tr>
		<td><small>6. Percent couples with children</td>
		<td><small>6. Percent between 50-64 years</small></td>
		<td><small>6. Percent homes build 1950-1979 </small></td>

	  </tr>
	  <tr>
		<td><small>7. Percent couples without children</td>
		<td><small>7. Percent people studying</small></td>
		<td><small>7. Percent homes build 1930-1949</small></td>

	  </tr>
	  	  <tr>
		<td><small>8. Percent net newcomers</td>
		<td><small>8. Percent between 30-39 years</small></td>
		<td><small>8. Percent homes with toilet and shower</small></td>

	  </tr>
	  <tr>
		<td><small>9. Percent people with a workman education</td>
		<td><small>9. Percent couples with children</small></td>
		<td><small>9. Percent houses with size 60m<sup>2</sup>-79m<sup>2</sup></small></td>

	  </tr>
	  <tr>
		<td><small>10. Percent houses larger than 120m<sup>2</sup></td>
		<td><small>10. Percent with a medium long education</small></td>
		<td><small>10. Percent net newcomers</small></td>

	  </tr>
	</table>
</div>
</article><div class="inside-article">				
	<h2>
	Conclusin for regression
	</h2>
	<p>
	Both of the regression methods performed well. Their predictions errors are generally low of around 5%. Even lower if elastic net is used for the individual years and random forest for all the years combined.
	The most important features make a lot of sense and is a good guideline for you, if you want to look for your ideal district!
	</p>
<article>
	<h2>Clustering</h2>
		<div class="article-info">K-means</div>
			<div class="text-container">
				<p>
					Now you might have decided on the district that is just right for you! But what if you want to try something new at some point? Fear not! Using a K-means algortihm with 4 clusters.
					We have made a map where each cluster is colored in a different color. The K-means algortihm is run on the features:
				</p>
				<ul>
				<li>Percent with low income</li>
				<li>Percent with medium income</li>
				<li>Percent with high income</li>
				<li>Percent danes</li>
				<li>Number of homes</li>
				<li>Number of inhabitants</li>
				<li>Homes above 120 m<sup>2</sup></li>
				<li>Percent people above 65 years</li>
				 </ul>
				 <p>
				 The data was standarized before running the algorithm, since some of the numbers are a lot higher than others, and would just dominate otherwise.
				 The result can be seen for each year by using the slider. This way you can see if your new favourite district tend to change cluster over the years and should be avoided.
				 A cluster might change color over the years. But this is simply due to the nature of K-means! Do not worry!
				 </p>
				 <p>
				 Enjoy! And happy hunting for a similar district!
				 </p>
			</div>
			<div class="viz-container-2 container"></div>
			<div class="viz-container-1 container"></div>
			<div class="group-viz">
				<div>

					
			</div>
				<div class="slider" style="width:800px">
					<p>
				      <label for="amount" class ="slider-label">Year:</label>
				      <input type="text" id="amount" readonly class="slider-input">
				    </p>
					<div id="slider-range-max"></div>
				<div>
			</div>
		</div>
</article>
	
	<footer class="clear">
		<p>&copy; 2015 sitename. <a href="http://zypopwebtemplates.com/">Website Template by</a> by ZyPOP</p>
	</footer>
</section>
	<div class="clear"></div>
</section>

<script>
var W = 600;
var H = 530;
var centered;

var margin = {top: 20, right: 10, bottom: 20, left: 10};
var W = W - margin.left - margin.right,
    H = H - margin.top - margin.bottom;


//------COLOR ON MAP---------//
var nrOfColours = 4
var colours = colorbrewer.Accent[nrOfColours]

var heatmapColour = d3.scale.threshold()
  .domain(d3.range(0, 1, 1.0 / (colours.length - 1)))
  .range(colours);
// dynamic bit...
var c = d3.scale.linear().domain([0.9,4.1]).range([0,1]);
//--------------------------//

//---------CREATE BASIS FOR GEOJSON MAP AND BAR------//
var svg = d3.select(".viz-container-1").append("svg")
    .attr("width", W + margin.left + margin.right)
    .attr("height", H + margin.top + margin.bottom)
  	.append("g")
    .attr("transform", "translate(" + margin.left + "," + margin.top + ")")
    .attr("id",'chart1');

svg.append("rect")
    .attr("class", "background")
    .attr("width", W + margin.left + margin.right)
    .attr("height", H + margin.top + margin.bottom)
    .attr("transform", "translate(" + margin.left + "," + margin.top + ")")
    .on("click", clicked);

var mapG = svg.append("g");

var p = d3.geo.mercator()
			.center([12.5541493,55.673577])
			.scale(135000)

			.translate([W / 2, H / 2]);
var path = d3.geo.path().projection(p);

createMap()

var districtTitle = svg.append("g")
  .attr("class", "title")
  .style("display", "none");
    
districtTitle.append("rect")
  .attr("width", W)
  .attr("height", 60)
  .attr("fill", "white")
  .style("opacity", 0.8);

districtTitle.append("text")
  .attr('x',W/2)
  .attr("dy", "1.2em")
  .style("text-anchor", "middle")
  .attr("font-size", "35px")
  .attr("font-weight", "bold")
  .text('Bagsv√¶rds');

var tip = d3.tip()
	  .attr('class', 'd3-tip')
	  .offset([0,0])
	  .html(function(d) {
      year = d3.select('#amount').property("value")
	  	return 	"<div  class='tiphead' ><strong>"+ d['properties']['rodenavn'] +"</strong></div>" + 
	    		"<div><strong>Number of homes:</strong> <span class='tipperCol' >" + d['properties'][year]['Num_house'] + "</span></div>" +
          "<div><strong>Number of inhabitants:</strong> <span class='tipperCol' >" + d['properties'][year]['Num_people'] + "</span></div>" +
          "<div><strong>% of high income:</strong> <span class='tipperCol' >" + d['properties'][year]['High_inc'] + "%</span></div>" +
          "<div><strong>% of danes:</strong> <span class='tipperCol' >" + d['properties'][year]['Pct_danes'] + "%</span></div>" ;
	  });
svg.call(tip);
//-----------------//

var globalRodeId = 1;


function editBar(rodeId) {
}

function clicked(d,rodeId) {
  var x, y, k;

  if (d && centered !== d) {
    var centroid = path.centroid(d);
    x = centroid[0];
    y = centroid[1];
    k = 4;
    centered = d;
    districtTitle.style("display", null)
    districtTitle.select("text").text(d.properties.rodenavn)

    editBar(rodeId)
  } else {
    x = W / 2;
    y = H / 2;
    k = 1;
    centered = null;
    districtTitle.style("display", "none")

  }

  mapG.selectAll("path")
      .classed("active", centered && function(d) { return d === centered; });

  mapG.transition()
      .duration(750)
      .attr("transform", "translate(" + W / 2 + "," + H / 2 + ")scale(" + k + ")translate(" + -x + "," + -y + ")")
      .style("stroke-width", 1.5 / k + "px");
}
var objective = 'High_inc'

d3.select('.Pct_danes').on('click', function(){
  d3.select('.caption').text('% of Danes')
  objective = 'Pct_danes'
  year = d3.select('#amount').property("value")
  editMap(mapG,year,objective)
});

d3.select('.High_inc').on('click', function(){
  d3.select('.caption').text('% of high income')
  objective = 'High_inc'
  year = d3.select('#amount').property("value")
  editMap(mapG,year,objective)
});




function createMap() {
	d3.json("d3-data/geodata_clustering.geojson", function(error,json) {

    if (error) throw error;
    mapG.append("g")
      .selectAll("path")
      .data(json.features)
      .enter()
      .append("path")
      .attr("d", path)
      .on('mouseover', tip.show)
      .on('mouseout', tip.hide)
      .on("click", function(d,i){
     		rodeId = d3.select(this).attr("id")
     		globalRodeId = rodeId;
            // editBar(rodeId);
            clicked(d,rodeId)
         })
     .attr('class','map-district')
     .attr('id', function(d){
     		return d.properties.rode_nr
     })
     .style("fill", function(d) {
     		//Get data value
     		var value = d['properties']['2013']['cluster']
     		
	   		if (value == 1) {
		   		return colours[0]
	   		 } else if (value == 2) {
	   		 	return colours[1]
	   		 } else if (value == 3) {
	   		 	return colours[2]
	   		 } else if (value == 4) {
	   		 	return colours[3]
	   		 } else {
		     	return "#9EA0A0";
	   		}
     });
	});
}

function editMap(map,year,objective) {
	
 	mapG.selectAll("path")
        .transition()
        .duration(500)
        .style("fill", function(d) { 
	   		//Get data value
	   		var value = d['properties'][year]['cluster']

	   		if (value == 1) {
		   		return colours[0]
	   		 } else if (value == 2) {
	   		 	return colours[1]
	   		 } else if (value == 3) {
	   		 	return colours[2]
	   		 } else if (value == 4) {
	   		 	return colours[3]
	   		 } else {
		     	return "#9EA0A0";
	   		}
	   	});
}
 
$( function() {
	$( "#slider-range-max" ).slider({
	range: "max",
	min: 2008,
	max: 2013,
	value: 2013,
	slide: function( event, ui ) {
	    $( "#amount" ).val( ui.value );

	    var datayear = ui.value.toString() 
	    editMap(mapG, datayear, objective);
	    editBar(globalRodeId)
	}
	});
	$( "#amount" ).val( $( "#slider-range-max" ).slider( "value" ) );
} );
</script>


</body>
</html>
