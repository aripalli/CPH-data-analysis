<!DOCTYPE html>
<!doctype html>
<html>
<head>
<meta charset="UTF8">
<title>Social Data & Visualization - Final Project</title>
<link rel="stylesheet" href="styles.css" type="text/css" />
<link rel="stylesheet" href="svg-styles.css?version=11" type="text/css" />
<link rel="stylesheet" href="//code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
<script src="https://code.jquery.com/jquery-1.12.4.js"></script>
<script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
<script type="text/javascript" src="d3/d3.js"></script>
<script type="text/javascript" src="d3/index.js"></script>
<script src="colorbrewer.min.js"></script>
<!--[if lt IE 9]>
<script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script>
<![endif]-->
<!--
anatine, a free CSS web template by ZyPOP (zypopwebtemplates.com/)

Download: http://zypopwebtemplates.com/

License: Creative Commons Attribution
//-->
<meta name="viewport" content="width=device-width, minimum-scale=1.0, maximum-scale=1.0" />
</head>

<body>
<section id="body" class="width">
		<aside id="sidebar" class="column-left">
			<header>
				<h1><a href="#">Final<br> Project</a></h1>
				<h2>Social Data & Visualization<br>Course 02806 @ DTU </h2>
			</header>
			<nav id="mainnav">
				<ul>
	            	<li><a href="index.html">Home</a></li>
	           		<li><a href="#">About the data</a></li>
	           		<li><a href="pred.html">Predictions</a></li>
	           		<li><a href="machinelearning.html">Machine Learning</a></li>
	            	<li><a href="#">Ipython notebook</a></li>
	            	<li><a href="#">Contact</a></li>
	            	<li><a href="nationality.html">Nationality</a></li>
	            </ul>
			</nav>
		</aside>		
	<section id="content" class="column-right">  		
	    <article>			
		<h2>Nationality in Copenhagen over the years</h2>

			<div class="text-container">
				<p>
					Something clever, corny and catchy here please!
				</p>
			</div>
				<div>
				<select class="Country select-style"></select>
				<select id="Data" class="select-style">
					<option value=""  selected="selected">Data without districts</option>
			        <option value="1">Data with districts</option>
				</select>
				<select class="District select-style"></select>
				<select id="inds" class="select-style">
				        <option value="Percentage" selected="selected">Percentage</option>
				        <option value="Total">Total</option>
				        <option value="Both" selected="selected">Both</option>
				</select>
				</div>

				<div class="viz-container"></div>





		
		</article>
		<article>
		<h2>Other title</h2>
			<div class="article-info">Social Data & Visualization 2017</div>
			<div class="text-container">
				<p>
					Lorem ipsum dolor sit amet, consectetur adipiscing elit. Nunc vulputate ante eget imperdiet aliquet. Quisque eget eros lacus. Etiam tempor, libero ut dapibus sagittis, mi sapien aliquet dui, et pretium eros arcu id magna. Vivamus blandit a turpis at sollicitudin. Donec sed mi at justo finibus faucibus eu vulputate quam. Curabitur congue, sapien eget aliquam eleifend, orci risus ullamcorper mauris, eu sagittis est lectus sed dolor. Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. In tortor odio, commodo eu efficitur nec, dignissim quis dolor.
				</p>
			</div>

			<div class="viz-container"></div>
		</article>
		
		<footer class="clear">
			<p>&copy; 2015 sitename. <a href="http://zypopwebtemplates.com/">Website Template by</a> by ZyPOP</p>
		</footer>
	</section>
	<div class="clear"></div>
</section>




<style> /* set the CSS */

path { 
    stroke: #01665e;
    stroke-width: 3;
    fill: none;
}

.axis path,
.axis line {
    fill: none;
    stroke: grey;
    stroke-width: 1;
    shape-rendering: crispEdges;
}

</style>

<!-- load the d3.js library -->    
<script src="http://d3js.org/d3.v3.min.js"></script>

<script>
var colours = colorbrewer.BrBG[11]
console.log(colours)
// Set the dimensions of the canvas / graph
var margin = {top: 30, right: 40, bottom: 30, left: 50},
    width = 700- margin.left - margin.right,
    height = 350 - margin.top - margin.bottom;
    var padding = 30;

// Parse the date / time
var parseDate = d3.time.format("%d-%b-%y").parse;

// Set the ranges
var x = d3.scale.linear().range([padding, width - padding * 2]);
var y = d3.scale.linear().range([height - padding, 0]);
var y1 = d3.scale.linear().range([height - padding, 0]);
// Define the axes
var xAxis = d3.svg.axis().scale(x).orient("bottom").tickFormat(d3.format("y"));

var yAxisLeft = d3.svg.axis().scale(y)
    .orient("left").ticks(5);
var yAxisRight = d3.svg.axis().scale(y1)
    .orient("right").ticks(5); 



var secVar = "Total"

// Define the line
var valueline = d3.svg.line()
    .x(function(d,section) { return x(d.AAR); })
    .y(function(d,section) {
            if(secVar == "Percentage") {return y(d.Percentage)}
            else {return y(d.Total)}  
});

var valueline2 = d3.svg.line()
    .x(function(d) { return x(d.AAR); })
    .y(function(d) { 
        return y1(d.Percentage)});
    
// Adds the svg canvas
var svg = d3.select(".viz-container").append("svg")
        .attr("width", width + margin.left + margin.right)
        .attr("height", height + margin.top + margin.bottom)
    	.append("g")
        .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

// Get the data
var dataset = "KBH_Stats_noDanes_noBydel_1.csv"
theCreation(dataset)

function DataSelection() {
    var sect = document.getElementById("Data");
    secVar = sect.options[sect.selectedIndex].value;
    var District = 0
    if (secVar == "1")
    {
        dataset = "KBH_Stats_noDanes.csv"
        District = 1
    }
    else
    {
        dataset = "KBH_Stats_noDanes_noBydel_1.csv"
    }
    theCreation(dataset,District)
}

function theCreation(dataset,District)
{
	d3.csv(dataset, function(error, data) {
	    data.forEach(function(d) {
	        d.AAR = +d.AAR;
	        d.STATKODE = +d.STATKODE;
	        d.Total = +d.Total;
	        d.Percentage = +d.Percentage;
	        if (District == 1)
	        {
	        	d.District =+ d.BYDEL
	        }
	    });


	    // When Country is change!
	    var select = d3.select('.Country')
	        .attr('class','select Country')
	        .on('change',onchange)



	    var options = select
	      .selectAll('option')
	        .data(d3.map(data, function(d){return d['COUNTRY'];}).keys().sort())
	        .enter()
	        .append('option')
	            .text(function (d) { return d});

	    // When District is Change!
	    if (District == 1)
	    {
	    	var select = d3.select('.District')
	        .attr('class','select District')
	        .on('change',onchange)
		    var options = select
		      .selectAll('option')
		        .data(d3.map(data, function(d)
		        {
		        	return d['DISTRICT']
		        }).keys().sort())
		        
		        .enter()
		        .append('option')
		            .text(function (d) { return d});
	    }
	    else
	    {
	    	var select = d3.select('.District')
	        .attr('class','select District')
		    var options = select
		      .selectAll('option')
		      	.remove()
		        .append('option')
		            .text(function (d) { return 'All Districts'});
	    }

	    // When The Option is change!
	    d3.select('#inds')
	        .on('change',onchange)

	    // Dataset is change!
	    d3.select('#Data')
	    	.on('change',DataSelection)

	    function onchange() {
	        selectValueCountry = d3.select('.Country').property('value')
	        selectValueDistrict = d3.select('.District').property('value')
	        plot(data,selectValueCountry,selectValueDistrict)
	    }



	    function plot(data,selectValueCountry){
	        var sect = document.getElementById("inds");
	        secVar = sect.options[sect.selectedIndex].value;

	        // Filter the data
	        data = data.filter(function(row)
	        {
	        	if (District == 1)
	        	{
	        		return (row['COUNTRY'] == selectValueCountry && row['DISTRICT'] == selectValueDistrict);
	        	}
	        	else
	        	{
		            return row['COUNTRY'] == selectValueCountry;	
	        	}

	        });
	        // Clear data from plot

	        svg.selectAll('*').remove();
	        

	        // Scale the range of the data
	        x.domain(d3.extent(data, function(d) 
	       	{
	       		return d.AAR 
	       	}));

	        if (secVar == "Both")
	        {
	            y.domain([0, d3.max(data, function(d) 
	            { 
	                return Math.max(d.Total);
	            })]);

	            y1.domain([0, d3.max(data, function(d) 
	            { return Math.max(d.Percentage);
	            })]);
	                    // Add the valueline path.
	            svg.append("path")
	            .attr("d", valueline(data,secVar));


	            // Add the valueline path.
	            svg.append("path")
	            .attr("class", "line")
	            .style("stroke", colours[2])
	            .attr("d", valueline2(data));

	            // Add the X Axis
	            svg.append("g")
	            .attr("class", "x axis")
	            .attr("transform", "translate(0," + height + ")")
	            .call(xAxis);

	            // Add the Y Axis
	             svg.append("g")
	            .attr("class", "y axis")
	            .style("fill", colours[10])
	            .call(yAxisLeft);

	            svg.append("g")             
	            .attr("class", "y axis")
	            .attr("transform", "translate(" + width + " ,0)")     
	            .style("fill", colours[2])       
	            .call(yAxisRight);

	            svg.append("text")
	            .attr("text-anchor", "middle")  // this makes it easy to centre the text as the transform is applied to the anchor
	            .attr("transform", "translate("+ (width/2-50) +","+(height+(padding))+")")  // centre below axis
	            .text("Year");

	            svg.append("text")
	            .attr("text-anchor", "middle")  // this makes it easy to centre the text as the transform is applied to the anchor
	            .attr("transform", "translate("+ (padding/2) +","+(height/2)+")rotate(-90)")  // text is drawn off the screen top left, move down and out and rotate
	            .text("Total");

	            svg.append("text")
	            .attr("text-anchor", "middle")  // this makes it easy to centre the text as the transform is applied to the anchor
	            .attr("transform", "translate("+  (width - (padding/2)) +","+(height/2) +")rotate(90)")  // text is drawn off the screen top left, move down and out and rotate
	            .text("Percentage");

	        }
	        else
	        {

	            y.domain([0, d3.max(data, function(d) 
	            { 
	                if(secVar == 'Percentage') {return d.Percentage}
	                else {return d.Total} 
	            })]);
	            
	            // Add the valueline path.
	            svg.append("path")
	            .attr("class", "line")
	            .attr("d", valueline(data,secVar));
	        	// Add the X Axis
	            svg.append("g")
	            .attr("class", "x axis")
	            .attr("transform", "translate(0," + height + ")")
	            .call(xAxis);

	            svg.append("text")
	            .attr("text-anchor", "middle")  // this makes it easy to centre the text as the transform is applied to the anchor
	            .attr("transform", "translate("+ (width/2-50) +","+(height+(padding))+")")  // centre below axis
	            .text("Year");

		        // Add the Y Axis
		        svg.append("g")
		            .attr("class", "y axis")
		            .call(yAxisLeft);
		        
		    	svg.append("text")
		        .attr("text-anchor", "middle")  // this makes it easy to centre the text as the transform is applied to the anchor
		        .attr("transform", "translate("+ (padding/2) +","+(height/2)+")rotate(-90)")  // text is drawn off the screen top left, move down and out and rotate
		        .text(secVar);

	        }

	    }



	});
}

</script>
</body>